---
import Layout from '../../layouts/Layout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug }
  }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug('blog', slug);

if (!post) {
  return Astro.redirect('/404');
}

const allPosts = await getCollection('blog');

// Render the markdown content
const { Content } = await post.render();

// Sort posts by date (newest first)
const sortedPosts = allPosts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// Format tanggal menjadi format Indonesia
function formatDate(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleDateString('id-ID', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Fungsi untuk mendapatkan postingan sebelumnya dan berikutnya
function getAdjacentPosts(currentSlug: string) {
  const currentIndex = sortedPosts.findIndex(post => post.slug === currentSlug);
  const prevPost = currentIndex > 0 ? sortedPosts[currentIndex - 1] : null;
  const nextPost = currentIndex < sortedPosts.length - 1 ? sortedPosts[currentIndex + 1] : null;
  
  return { prevPost, nextPost };
}

const { prevPost, nextPost } = getAdjacentPosts(slug);
---

<Layout title={`${post.data.title} - Blog Faisal Rachmadi`} description={post.data.summary}>
  <style>
    .article-header {
      text-align: center;
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid #e9ecef;
    }
    
    .article-header h1 {
      font-size: 2.5rem;
      color: #333;
      margin-bottom: 1rem;
      line-height: 1.3;
    }
    
    .article-meta {
      display: flex;
      justify-content: center;
      gap: 2rem;
      color: #666;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    
    .article-content {
      background: white;
      padding: 3rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 3rem;
      line-height: 1.8;
      color: #444;
    }
    
    .article-content p {
      margin-bottom: 1.5rem;
    }
    
    .article-content h2 {
      color: #333;
      margin: 2rem 0 1rem 0;
      border-bottom: 2px solid #007bff;
      padding-bottom: 0.5rem;
    }
    
    .article-content h3 {
      color: #333;
      margin: 1.5rem 0 1rem 0;
    }
    
    .navigation {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid #e9ecef;
    }
    
    .nav-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 1.5rem;
      background: white;
      border: 2px solid #007bff;
      color: #007bff;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s;
      max-width: 250px;
    }
    
    .nav-button:hover {
      background: #007bff;
      color: white;
    }
    
    .nav-button.prev {
      text-align: left;
    }
    
    .nav-button.next {
      text-align: right;
      flex-direction: row-reverse;
    }
    
    .nav-button .arrow {
      font-weight: bold;
      font-size: 1.2rem;
    }
    
    .nav-button .text {
      display: flex;
      flex-direction: column;
    }
    
    .nav-button .label {
      font-size: 0.8rem;
      opacity: 0.7;
    }
    
    .nav-button .title {
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #007bff;
      text-decoration: none;
      margin-bottom: 2rem;
      font-weight: 500;
    }
    
    .back-link:hover {
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .article-header h1 {
        font-size: 2rem;
      }
      
      .article-meta {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .article-content {
        padding: 2rem 1.5rem;
      }
      
      .navigation {
        flex-direction: column;
      }
      
      .nav-button {
        max-width: none;
      }
    }
  </style>

  <a href="/blog/" class="back-link">
    ‚Üê Kembali ke Daftar Artikel
  </a>

  <header class="article-header">
    <h1>{post.data.title}</h1>
    <div class="article-meta">
      <span>üìÖ {formatDate(post.data.date)}</span>
      <span>‚è±Ô∏è {post.data.readTime}</span>
    </div>
  </header>

  <article class="article-content">
    <Content />
  </article>

  <nav class="navigation">
    {prevPost ? (
      <a href={`/blog/${prevPost.slug}/`} class="nav-button prev">
        <span class="arrow">‚Üê</span>
        <div class="text">
          <span class="label">Artikel Sebelumnya</span>
          <span class="title">{prevPost.data.title}</span>
        </div>
      </a>
    ) : (
      <div></div>
    )}
    
    {nextPost ? (
      <a href={`/blog/${nextPost.slug}/`} class="nav-button next">
        <span class="arrow">‚Üí</span>
        <div class="text">
          <span class="label">Artikel Berikutnya</span>
          <span class="title">{nextPost.data.title}</span>
        </div>
      </a>
    ) : (
      <div></div>
    )}
  </nav>
</Layout>